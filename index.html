<!DOCTYPE html>
<html>
<head>
    <title>Tilt Golf Prototype - Final Assignment</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        /* === GLOBAL STYLES & FULL-SCREEN MAP === */
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #1a7a1f; /* Default Golf Green */
            color: white;
            font-family: Arial, sans-serif;
            width: 100%;
            height: 100%;
        }

        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #game-area {
            width: 100%;
            height: 100%;
            position: absolute;
            display: none; /* Hidden until game starts */
        }

        /* === GAME ELEMENTS === */
        #ball {
            position: absolute;
            width: 15px; /* Smaller ball */
            height: 15px;
            border-radius: 50%;
            background: #f0f0f0; /* White/Silver for golf ball */
            border: 1px solid #333;
            z-index: 10;
        }

        #hole {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #000; /* Black hole */
            border: 2px solid #fff;
            z-index: 5;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5); /* Look of depth */
        }

        .trap {
            position: absolute;
            z-index: 5;
        }

        .water-trap {
            background: #007bff; /* Blue water */
            border: 3px solid #0056b3;
            /* Example of irregular shape using border-radius */
            border-radius: 70% 30% 45% 85% / 60% 40% 75% 25%; 
        }

        .sand-trap {
            background: #f4d03f; /* Yellow/tan sand */
            border: 2px solid #b7950b;
            /* Example of irregular shape using border-radius */
            border-radius: 30% 80% 60% 40% / 50% 60% 50% 50%;
        }

        /* === Menu/Overlay Styles === */
        #start-menu, #game-over, #map-select {
            background: rgba(0, 0, 0, 0.9);
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            z-index: 100;
            width: 80%;
            max-width: 400px;
        }
        
        button {
            padding: 10px 20px;
            margin: 10px;
            font-size: 1.1em;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
        }

        /* === Water Boundary Visual Cue === */
        #water-border-top, #water-border-bottom, #water-border-left, #water-border-right {
            position: absolute;
            background-color: rgba(0, 119, 190, 0.7); /* Light blue border */
            z-index: 20;
        }
        #water-border-top, #water-border-bottom {
            width: 100%;
            height: 10px;
        }
        #water-border-left, #water-border-right {
            height: 100%;
            width: 10px;
        }
        #water-border-top { top: 0; left: 0; }
        #water-border-bottom { bottom: 0; left: 0; }
        #water-border-left { top: 0; left: 0; }
        #water-border-right { top: 0; right: 0; }
        
    </style>
</head>
<body>

    <div id="game-container">
        <div id="map-select">
            <h1>Select a Course</h1>
            <div id="map-buttons">
                </div>
        </div>

        <div id="start-menu" style="display: none;">
            <h1 id="course-title"></h1>
            <p>Guide the ball to the hole by tilting your phone.</p>
            <button onclick="startGame()">Start Course</button>
            <button onclick="showMapSelect()">Change Course</button>
        </div>

        <div id="game-area">
            <div id="water-border-top"></div>
            <div id="water-border-bottom"></div>
            <div id="water-border-left"></div>
            <div id="water-border-right"></div>
            
            <div id="ball"></div>
            <div id="hole"></div>
            </div>

        <div id="game-over" style="display: none;">
            <h2 id="game-over-message">You Win!</h2>
            <button onclick="showMapSelect()">Play Again</button>
        </div>
    </div>

    <script>
        // === CONFIGURATION (Easily Tweakable Values) ===
        const CONFIG = {
            DEAD_ZONE_TILT_THRESHOLD: 5, // Degrees. Tilt must be greater than this to move the ball.
            BASE_SPEED: 0.1, // Slower base speed for more control
            FRICTION: 0.99, // *** INCREASED for more momentum ***
            BOUNCE_FACTOR: -0.2
        };

        // === MAP DATA ===
        const MAP_DATA = [
            {
                id: 0,
                name: "The Beginner's Tee",
                startPos: { x: 50, y: 50 },
                holePos: { x: 70, y: 80 }, // Percentage from top-left for responsiveness
                traps: [
                    { type: 'sand', x: 20, y: 20, w: 15, h: 15 }, // %
                    { type: 'water', x: 50, y: 50, w: 25, h: 8 },  // %
                ]
            },
            {
                id: 1,
                name: "The River Run",
                startPos: { x: 90, y: 10 },
                holePos: { x: 10, y: 90 }, // %
                traps: [
                    { type: 'water', x: 15, y: 50, w: 70, h: 10 }, // Long water hazard
                    { type: 'sand', x: 80, y: 40, w: 10, h: 10 },
                    { type: 'sand', x: 5, y: 70, w: 15, h: 15 },
                ]
            }
        ];

        // --- Game State Variables ---
        let currentMapId = 0;
        let ballX = 0;
        let ballY = 0;
        let velocityX = 0;
        let velocityY = 0;
        let currentSpeedFactor = 1; // Used for sand traps
        let gameActive = false;

        // --- DOM Elements ---
        const ball = document.getElementById('ball');
        const gameArea = document.getElementById('game-area');
        const startMenu = document.getElementById('start-menu');
        const gameOver = document.getElementById('game-over');
        const mapSelect = document.getElementById('map-select');

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            initializeMapButtons();
        });

        function initializeMapButtons() {
            const container = document.getElementById('map-buttons');
            MAP_DATA.forEach(map => {
                const button = document.createElement('button');
                button.textContent = map.name;
                button.onclick = () => selectMap(map.id);
                container.appendChild(button);
            });
            showMapSelect();
        }
        
        function showMapSelect() {
            startMenu.style.display = 'none';
            gameArea.style.display = 'none';
            gameOver.style.display = 'none';
            mapSelect.style.display = 'block';
            gameActive = false;
        }

        function selectMap(mapId) {
            currentMapId = mapId;
            const map = MAP_DATA[mapId];
            document.getElementById('course-title').textContent = map.name;
            
            // Show start menu for the selected map
            mapSelect.style.display = 'none';
            startMenu.style.display = 'block';
        }

        function startGame() {
            const map = MAP_DATA[currentMapId];
            
            startMenu.style.display = 'none';
            gameOver.style.display = 'none';
            gameArea.style.display = 'block';

            // Reset state
            velocityX = 0;
            velocityY = 0;
            currentSpeedFactor = 1;

            // Apply map layout
            loadMap(map);

            gameActive = true;
            
            // Request permission for motion sensors (required on iOS/Safari)
            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission()
                    .then(permissionState => {
                        if (permissionState === 'granted') {
                            window.addEventListener('devicemotion', handleMotion);
                        } else {
                            alert("Motion access denied. Game cannot be played.");
                        }
                    })
                    .catch(console.error);
            } else {
                window.addEventListener('devicemotion', handleMotion);
            }

            requestAnimationFrame(gameLoop);
        }

        function loadMap(map) {
            // Clear old traps
            document.querySelectorAll('#game-area .trap').forEach(trap => trap.remove());

            // Set ball initial position (from percentage to pixel)
            ballX = (gameArea.clientWidth * map.startPos.x) / 100;
            ballY = (gameArea.clientHeight * map.startPos.y) / 100;

            // Set hole position
            const hole = document.getElementById('hole');
            hole.style.left = (gameArea.clientWidth * map.holePos.x) / 100 - (hole.clientWidth / 2) + 'px';
            hole.style.top = (gameArea.clientHeight * map.holePos.y) / 100 - (hole.clientHeight / 2) + 'px';

            // Add new traps
            map.traps.forEach(t => {
                const trapDiv = document.createElement('div');
                trapDiv.className = `trap ${t.type}-trap`;
                trapDiv.style.left = (gameArea.clientWidth * t.x) / 100 + 'px';
                trapDiv.style.top = (gameArea.clientHeight * t.y) / 100 + 'px';
                trapDiv.style.width = (gameArea.clientWidth * t.w) / 100 + 'px';
                trapDiv.style.height = (gameArea.clientHeight * t.h) / 100 + 'px';
                
                // Add bounding box info for collision helper
                trapDiv.dataset.x = trapDiv.offsetLeft;
                trapDiv.dataset.y = trapDiv.offsetTop;
                trapDiv.dataset.w = trapDiv.offsetWidth;
                trapDiv.dataset.h = trapDiv.offsetHeight;
                
                gameArea.appendChild(trapDiv);
            });
            
            ball.style.left = ballX + 'px';
            ball.style.top = ballY + 'px';
        }


        // --- Sensor Handling ---
        function handleMotion(event) {
            if (!gameActive) return;

            const acceleration = event.accelerationIncludingGravity;

            // Calculate a rough degree tilt (using atan2 is more accurate, but this is simple)
            const degTiltX = Math.atan(acceleration.x / 9.8) * (180 / Math.PI);
            const degTiltY = Math.atan(acceleration.y / 9.8) * (180 / Math.PI);

            // --- Apply Dead Zone ---
            if (Math.abs(degTiltX) > CONFIG.DEAD_ZONE_TILT_THRESHOLD) {
                 // *** FIX 1: Added negative sign to reverse X-axis ***
                 velocityX += -acceleration.x * CONFIG.BASE_SPEED * currentSpeedFactor; 
            }
            if (Math.abs(degTiltY) > CONFIG.DEAD_ZONE_TILT_THRESHOLD) {
                // *** FIX 1: Removed negative sign to reverse Y-axis ***
                velocityY += acceleration.y * CONFIG.BASE_SPEED * currentSpeedFactor; 
            }
        }


        // --- Main Game Loop ---
        function gameLoop() {
            if (!gameActive) return;

            // 1. Apply Friction/Damping
            velocityX *= CONFIG.FRICTION;
            velocityY *= CONFIG.FRICTION;

            // 2. Update Position
            ballX += velocityX;
            ballY += velocityY;

            // 3. Check for Traps/Hole (Collision Detection)
            checkCollisions();

            // 4. Handle Wall Collisions (Water Edges)
            const maxX = gameArea.clientWidth - ball.clientWidth;
            const maxY = gameArea.clientHeight - ball.clientHeight;

            let hitWall = false;

            if (ballX < 0) {
                ballX = 0;
                velocityX *= CONFIG.BOUNCE_FACTOR;
                hitWall = true;
            } else if (ballX > maxX) {
                ballX = maxX;
                velocityX *= CONFIG.BOUNCE_FACTOR;
                hitWall = true;
            }

            if (ballY < 0) {
                ballY = 0;
                velocityY *= CONFIG.BOUNCE_FACTOR;
                hitWall = true;
            } else if (ballY > maxY) {
                ballY = maxY;
                velocityY *= CONFIG.BOUNCE_FACTOR;
                hitWall = true;
            }
            
            // If any wall is hit, it's a water hazard!
            if (hitWall) {
                gameOverScreen("Splash! Went out of bounds.");
                return;
            }

            // 5. Update Ball Position on Screen
            ball.style.left = ballX + 'px';
            ball.style.top = ballY + 'px';

            requestAnimationFrame(gameLoop);
        }

        function gameOverScreen(message) {
             gameActive = false;
             gameArea.style.display = 'none';
             gameOver.style.display = 'block';
             document.getElementById('game-over-message').textContent = message;
        }

        // --- Collision Logic ---
        function checkCollisions() {
            const ballRect = ball.getBoundingClientRect();
            const holeRect = document.getElementById('hole').getBoundingClientRect();
            const traps = document.querySelectorAll('.trap');
            
            // Use client dimensions for more accurate collision checks (relative to viewport)
            const ballCenter = { 
                x: ballRect.left + ballRect.width / 2, 
                y: ballRect.top + ballRect.height / 2 
            };


            // ** HOLE COLLISION (Win Condition) **
            if (
                ballCenter.x > holeRect.left &&
                ballCenter.x < holeRect.right &&
                ballCenter.y > holeRect.top &&
                ballCenter.y < holeRect.bottom
            ) {
                gameOverScreen("In the Hole! Course Complete!");
                return;
            }

            // ** TRAP COLLISION (Sand/Water) **
            let inSandTrap = false;
            
            traps.forEach(trap => {
                const trapRect = trap.getBoundingClientRect();
                
                // Simple Bounding Box Collision Check
                if (
                    ballRect.right > trapRect.left &&
                    ballRect.left < trapRect.right &&
                    ballRect.bottom > trapRect.top &&
                    ballRect.top < trapRect.bottom
                ) {
                    // Check if ball is fully inside the trap's bounding box to be safer
                    if (ballRect.left > trapRect.left && ballRect.right < trapRect.right) {
                        if (trap.classList.contains('water-trap')) {
                            // Water Trap: Reset/Fail
                            gameOverScreen("Splash! Into the water hazard.");
                            return;
                        } else if (trap.classList.contains('sand-trap')) {
                            // Sand Trap: Slow down the ball significantly
                            inSandTrap = true;
                        }
                    }
                }
            });

            // Apply Sand Trap physics if collision detected
            if (inSandTrap) {
                currentSpeedFactor = 0.2; // Slow down momentum gain
                velocityX *= 0.8; // Apply immediate brake to existing velocity
                velocityY *= 0.8;
            } else {
                currentSpeedFactor = 1; // Restore normal speed
            }
        }
    </script>
</body>
</html>



